<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Manuten√ß√£o</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-dark-custom {
            background-color: #1a1d20;
        }
        .container-custom {
            background-color: #1a1d20;
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-dark">
    <nav class="navbar navbar-dark bg-dark border-bottom border-secondary">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" th:href="@{/solicitacao}">
                üîß Sistema de Manuten√ß√£o
            </a>
        </div>
    </nav>
    
    <main class="container-fluid bg-dark text-light py-4">
        <div class="container">
            <h1 class="mb-4 text-light">Solicita√ß√µes de Manuten√ß√£o</h1>

            <div class="table-responsive">
                <table class="table table-dark table-striped table-hover" th:unless="${#lists.isEmpty(solicitacoes)}">
                    <thead class="table-secondary">
                        <tr>
                            <th>#</th>
                            <th>Solicitante</th>
                            <th>Descri√ß√£o do Problema</th>
                            <th>Data Solicita√ß√£o</th>
                            <th>Prazo</th>
                            <th>Status</th>
                            <th>Data Finaliza√ß√£o</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="solicitacao : ${solicitacoes}">
                            <td th:text="${solicitacao.id}"></td>
                            <td th:text="${solicitacao.solicitante}"></td>
                            <td th:text="${solicitacao.descricaoProblema}"></td>
                            <td th:text="${#temporals.format(solicitacao.dataSolicitacao, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${#temporals.format(solicitacao.deadline, 'dd/MM/yyyy')}"></td>
                            <td>
                                <span th:if="${solicitacao.status?.name() == 'FINALIZADA'}" class="badge bg-success" th:text="${solicitacao.status?.name()}">FINALIZADA</span>
                                <span th:if="${solicitacao.status?.name() == 'EM_ANDAMENTO'}" class="badge bg-warning text-dark" th:text="${solicitacao.status?.name()}">EM_ANDAMENTO</span>
                                <span th:if="${solicitacao.status?.name() == 'PENDENTE'}" class="badge bg-secondary" th:text="${solicitacao.status?.name()}">PENDENTE</span>
                            </td>
                            <td>
                                <span th:if="${solicitacao.dataFinalizacao != null}" th:text="${#temporals.format(solicitacao.dataFinalizacao, 'dd/MM/yyyy HH:mm')}"></span>
                                <span th:if="${solicitacao.dataFinalizacao == null}" class="text-muted">-</span>
                            </td>
                            <td>
                                <form class="d-inline" th:action="@{/solicitacao/finalizar/{id}(id=${solicitacao.id})}" method="POST">
                                    <button type="submit" class="btn btn-sm btn-success" th:disabled="${solicitacao.status?.name() == 'FINALIZADA'}">Finalizar</button>
                                </form>
                                <a th:href="@{/solicitacao/edit/{id}(id=${solicitacao.id})}" 
                                   class="btn btn-sm btn-warning"
                                   th:classappend="${solicitacao.status?.name() == 'FINALIZADA'} ? 'disabled' : ''"
                                   th:disabled="${solicitacao.status?.name() == 'FINALIZADA'}">Editar</a>
                                <a th:href="@{/solicitacao/delete/{id}(id=${solicitacao.id})}" class="btn btn-sm btn-danger">Excluir</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div th:if="${#lists.isEmpty(solicitacoes)}" class="alert alert-info">
                <i class="fas fa-info-circle"></i> Nenhuma solicita√ß√£o de manuten√ß√£o cadastrada.
            </div>

            <a th:href="@{/solicitacao/create}" class="btn btn-primary mt-3">
                <i class="fas fa-plus"></i> Nova Solicita√ß√£o
            </a>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>